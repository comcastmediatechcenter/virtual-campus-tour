<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <title>Location</title>
    <style>
      html, body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #000;
      }

      .tooltip {
        max-width: 300px;
        max-height: 400px;
        min-width: 200px;
        min-height: 250px;
        background: #fff;
        color: #000;
        border-style: solid;
        border-color: #cfb87c;
        border-radius: 3px;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }
      .tooltip-header{
        padding-top: 0;
        width:auto;
        background: #cfb87c;
        text-align: left;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
      $(document).ready(function() {
        //$("body").css("display", "none");
        $("body").fadeIn("slow");

        $('a').click(function(e) {
          e.preventDefault();
          var dest = this.href;
          $('body').fadeOut('slow', function(){
            window.location = dest;
          });
        });
      });
    </script>
  </head>
  <body>
    <% location.tooltips.forEach(function(tt, i){ %>
      <div id="tt<%= i %>" style="display:none" class="tooltip">
        <header class="tooltip-header">
          <h1><%= tt.header %></h1>
        </header>
        <%= tt.body %>
      </div>
    <% }) %>
    <div class="w3-display-container">
      <a href="/">
        <img src="img/ui/home.png" alt="" class="w3-display-topleft w3-padding-small w3-image" style="max-width:40%;">
      </a>
      <img src="img/ui/logo.png" alt="" class="w3-display-topright w3-padding-small w3-image" onclick="window.location.href = '#'; " style="max-width:40%;">
      <script src="./js/three.min.js"></script>
      <script src="./js/panolens.min.js"></script>
      <script>
        const panorama = new PANOLENS.ImagePanorama('<%= location.image %>');
        var textureLoader = new THREE.TextureLoader();
        //var texture = textureLoader.load(url, function(){
        //  var infospot = new PANOLENS.Infospot('scale','url');
        //});
        <% location.tooltips.forEach(function(tt, i){ %>
          textureLoader.load("/img/ui/info.png", function(){
            var is = new PANOLENS.Infospot(300, "/img/ui/info.png", true);
            is.position.set(<%= tt.pos[0] %>, <%= tt.pos[1] %>, <%= tt.pos[2] %>);
            is.addHoverElement( document.getElementById('tt<%= i %>'), 200);
            panorama.add(is);
          });
        <% }); %>

        <% location.paths.forEach(function(path){ %>
          textureLoader.load("/img/ui/arrow.png", function(){
            var is = new PANOLENS.Infospot(300, "/img/ui/arrow.png");
            is.position.set(<%= path.pos[0] %>, <%= path.pos[1] %>, <%= path.pos[2] %>);
            is.addHoverText("<%= path.label %>");
            is.addEventListener("click", function(){ window.location.href = "<%= path.dest %>"});
            panorama.add(is);
          });
        <% }) %>

        const viewer = new PANOLENS.Viewer({output: 'console'});
        viewer.add(panorama);
      </script>
      <div class="panolens-container w3-display-middle" style="width: 100%; height: 100%; background-color: rgb(0, 0, 0); cursor: default;">
        <canvas class="panolens-canvas" style="width: 100%; height: 100%; display: block;"></canvas>
      </div>
    </div>
  </body>
</html>
